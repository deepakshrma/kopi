<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="apple-touch-icon" href="icon.png">
    <link rel="shortcut icon" sizes="196x196" href="icon.png">
    <meta name="apple-mobile-web-app-title" content="Kopi Morgan">
    <title>Kopi Morgan</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
</head>

<body style="margin-top: 1em;">


    <div class="container">
        <h1>Kopi Morgan</h1>
        <div id="summary">loading ...</div>
    </div>

    <script type="module">

        let orders = Object.entries(await fetch("/list").then(r => r.json()));

        let summary = orders.reduce((m, { name, drink }) => {
            m[drink] = [...(m[drink] || []), name];
            return m
        }, {});

        document.querySelector("#summary").innerHTML = Object.entries(summary).sort(([drink0], [drink1]) => drink0 < drink1).map(([drink, names]) =>
            `
                <h3>${drink} (${names.length})</h3>
                
                <ul>
                ${names.map(n => `<li>${n}</li>`).join("")}
                </ul>
            `
        ).join("") + `
                <div>Total drinks: ${orders.length}</div>
        `;

    </script>

</body>

</html>